<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SONARNL: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SONARNL
   &#160;<span id="projectnumber">1.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">SONARNL Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Copyright (c) 2004, 2005 ActivMedia Robotics, LLC<br/>
 Copyright (c) 2006-2010 MobileRobots Inc.<br/>
 Copyright (c) 2011-2015 Adept Technology<br/>
 All rights reserved. </p>
<h1><a class="anchor" id="sonarnlintro"></a>
Introduction to SonArnl</h1>
<p>SONARNL is MobileRobots Inc.'s software development library for localizing and intelligently navigating mobile robots within mapped indoor environments using basic sonar sensors only.</p>
<p>SONARNL uses sonar sensor information together with robot odometry data, and a prepared environment map to find the most probable position of the robot within the map, and resets ArRobot's pose to reflect that position within the map's coordinate system.</p>
<p><a href="../BaseArnl-Reference/index.html" target="_top">See the BaseArnl documentation for path planning and navigation information. </a></p>
<p>There are several additional libraries or packages which implement different localization techniques, plus the base library, 'BaseArnl', which includes the path planning task, as well as common features used by the localization libraries. Which localization libraries you have will depend on what software options were purchased. The 'Arnl' localization library contains ArLocalizationTask which uses data obtained from a scanning laser range finder (ArSick) to localize. Arnl is part of the "Laser Navigation" accessory package. The 'SonArnl' localization library contains <a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> which uses the sonar (ultrasonic range sensors) for more approximate localization. SonArnl is included with any MobileRobots robot platform and can be used with any MobileRobots robot equipped with sonar. The 'Mogs' localization library contains ArGPSLocalizationTask which uses data from a GPS receiver to correct for odometry error and to locate the robot in a georegistered map. GPS localization is part of the "MOGS Outdoor Navigation" accessory package. It is also possible to use more than one localization tequnique simultaneosly, merging them into a unified result, though this feature is still experimental. All of the localization task classes from the various libraries are derived from <a class="elRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArBaseLocalizationTask.html">ArBaseLocalizationTask</a> in the BaseArnl library.</p>
<p>Path planning and navigation is performed by the <a class="elRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArPathPlanningTask.html">ArPathPlanningTask</a> class in the BaseArnl library.</p>
<p>The map (ArMap, in the Aria library) used in localization and planning contains several types of data and objects. Maps may include designated forbidden areas, goals and a "home" poses. You can build maps using the Mapper3 (tm) application from MobileRobots. The two tasks run in background threads. See below for more discussion.</p>
<p>This reference manual describes the SonArnl library, which implements sonar localization in the <a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> class. For documentation on the BaseArnl library, see its reference manual in the docs directory.</p>
<h1><a class="anchor" id="sonarnlproguse"></a>
Programming and Using ArSonarLocalizationTask</h1>
<p><a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> implements the Monte Carlo Localization Algorithm to place the robot within a given line map of its operating environment, as derived from sonar-ranging and robot odometry information. The localization task is meant to be initialized and run as a separate thread within ARIA.</p>
<p>To write a program using SONARNL, include the Arnl/Aria.h, Arnl/Arnl.h, Arnl/ArSonarLocalizationTask.h, and, if needed, Arnl/ArNetworking.h header files with your source code and link it with libBaseArnl, libAriaForArnl, libAriaNetworkingForArnl, and libSonArnl libraries in Arnl/lib.</p>
<p>You need to include five basic objects to enable localization: ArRobot, ArMap, ArSonarDevice, <a class="elRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArPathPlanningTask.html">ArPathPlanningTask</a>, and <a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a>. Other objects will also be required, such as ArRobotConnector, etc.</p>
<p>For a complete example program using SONARNL see <a class="el" href="sonarnlServer_8cpp-example.html">sonarnlServer.cpp</a></p>
<p>First create an <a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> object with an instantiated ArRobot, an ArSonarDevice object and a line map of the robot's environment, explicitly as a file or from ArMap. For example,</p>
<div class="fragment"><div class="line"> <span class="comment">// Create the localization task (it will start its own thread here)</span></div>
<div class="line"> <a class="code" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> myLocTask(myRobot, mySonar, mapname);</div>
</div><!-- fragment --><p>Next initialize the robot's location inside the map and do an initial localization.</p>
<div class="fragment"><div class="line"><span class="comment">// Set the initial pose to the robot&#39;s &quot;Home&quot; position from the map, or</span></div>
<div class="line"><span class="comment">// (0,0,0) if none, then let the localization thread take over.</span></div>
<div class="line">myLocTask.localizeRobotAtHomeBlocking();</div>
</div><!-- fragment --><p>Thereafter, <a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> thread automatically acts to relocate the robot in the map. To conserve processing resources, automatic localization updates happen only when the robot has moved beyond set translational and/or rotational limits. By default, these limits are set to +-200 mm translation and +-5 degrees rotation but may be changed by modifying SONARNL's configuration parameters.</p>
<p>You can use tArBaseLocalizationTask::setRobotPose(), <a class="el" href="classArSonarLocalizationTask.html#ac251ca817425c40038638007c21d7448" title="Try initial localization at each home point at the map, and set the robot pose to the point with best...">ArSonarLocalizationTask::localizeRobotAtHomeBlocking()</a>, or <a class="el" href="classArSonarLocalizationTask.html#a1baa73c085f046f271d2283ef8ed07a2" title="Request that the task later localize the robot at a home position, and return immediately.">ArSonarLocalizationTask::localizeRobotAtHomeNonBlocking()</a>, to relocalize the robot at a new position at any time.</p>
<div class="fragment"><div class="line"><span class="comment">// If we know that the robot is actually at or near &#39;pose&#39; in the map, we can</span></div>
<div class="line"><span class="comment">// relocalize there:</span></div>
<div class="line">myLocTask.setRobotPose(pose);</div>
</div><!-- fragment --><p>Before running your SONARARNL-enabled application, you can first physically position the robot (or simulated robot) at a starting position, such as its home point or at the place corresponding to 0,0,0 in the map so that SONARARNL can sucessfully perform the initial localization at that known point when <a class="el" href="classArSonarLocalizationTask.html#ac251ca817425c40038638007c21d7448" title="Try initial localization at each home point at the map, and set the robot pose to the point with best...">ArSonarLocalizationTask::localizeRobotAtHomeBlocking()</a> is called. Or, connect with MobileEyes and use its "Localize Robot to Point" command to position the robot in the map and trigger a position reset and re-initialize localization at that new starting point.</p>
<h1><a class="anchor" id="sonarnlconfig"></a>
Configuring SONARNL Parameters</h1>
<p>Aria and SonArnl may be configured by modifying params/arnl.p, or through MobileEyes once it's running (if the program includes ArServerHandlerConfig object), or in the program through the global ArConfig object in Aria. For example, you can change the name of the map file used, change speeds and distance thresholds, etc. Each parameter has a description. The parameters are also described below. For most applications, only the "Normal" level parameters usually need to be changed, and sometimes a few "Advanced".</p>
<h1><a class="anchor" id="sonarresultstates"></a>
Sonar Localization Results and States</h1>
<p>Each time <a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> acts to update the robot's position in the map, it resets the pose of the ArRobot in ARIA (unless set not to do so). Hence, you may directly read the pose from the ArRobot class. There also are a number of functions in the <a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> class which can return the current robot location and the states of the localization. These flags and scores show the state of the localization. These functions include getLocalizationScore(), getSensorBelief(), getState() and getIdleFlag().</p>
<h1><a class="anchor" id="sonarfailcallback"></a>
Failed Callback.</h1>
<p><a class="el" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> can alert your program if it fails to update localization while running. In order to do this, add a callback function to the class using <a class="el" href="classArSonarLocalizationTask.html#a33d3845bdc8ac76cf08b663b242f8154" title="Adds a callback which will be called when loca fails.">ArSonarLocalizationTask::addFailedLocalizationCB()</a>. Remove the callback using the <a class="el" href="classArSonarLocalizationTask.html#a46a9e7193aba421adb71c56e173b218c" title="Removes a callback.">ArSonarLocalizationTask::remFailedLocalizationCB()</a> when finished.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;Aria/Aria.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Arnl.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArSonarLocalizationTask.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>MyClass {</div>
<div class="line">  <a class="code" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> *myLocTask;</div>
<div class="line">  ArFunctor1C&lt;MyClass, int&gt; myLocFailedCB;</div>
<div class="line">  <span class="keywordtype">void</span> failed(<span class="keywordtype">int</span> n);</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  MyClass(<a class="code" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> *locTask);</div>
<div class="line">  ~MyClass();</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">MyClass::MyClass(<a class="code" href="classArSonarLocalizationTask.html" title="Task that performs localization of the robot with sonar range sensors in a seperate asynchronous thre...">ArSonarLocalizationTask</a> *locTask) :</div>
<div class="line">  myLocTask(locTask),</div>
<div class="line">  myLocFailedCB(this, &amp;MyClass::failed)</div>
<div class="line">{</div>
<div class="line">  locTask-&gt;<a class="code" href="classArSonarLocalizationTask.html#a33d3845bdc8ac76cf08b663b242f8154" title="Adds a callback which will be called when loca fails.">addFailedLocalizationCB</a>(&amp;myLocFailedCB);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">MyClass::~MyClass()</div>
<div class="line">{</div>
<div class="line">  locTask-&gt;<a class="code" href="classArSonarLocalizationTask.html#a46a9e7193aba421adb71c56e173b218c" title="Removes a callback.">remFailedLocalizationCB</a>(&amp;myLocFailedCB);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MyClass::failed(<span class="keywordtype">int</span> n)</div>
<div class="line">{</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Localization failure.&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="sonarnlmapping"></a>
Making maps</h1>
<p>To localize, SonArnl needs a map of the robot's operating environment.</p>
<p>The mapping process is different for each localization method, though the map files are compatible and can be reused if they contain enough information useful to other methods (for example, laser localization in particular needs an accurate map of laser-sensed obstacles to match with laser readings). To learn more about creating a map for sonar localization with SonArnl, see <a href="../SonarMapping.txt">SonarMapping.txt</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Oct 27 2016 17:51:50 for SONARNL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
