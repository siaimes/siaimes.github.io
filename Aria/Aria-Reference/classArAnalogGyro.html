<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Aria: ArAnalogGyro Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Aria
   &#160;<span id="projectnumber">2.9.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classArAnalogGyro.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">ArAnalogGyro Class Reference<div class="ingroups"><a class="el" href="group__OptionalClasses.html">Optional Classes</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Use onboard gyro to improve the heading in an <a class="el" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> object's pose value.  
 <a href="classArAnalogGyro.html#details">More...</a></p>

<p><code>#include &lt;ArAnalogGyro.h&gt;</code></p>

<p><a href="classArAnalogGyro-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a348f63883ab1ea70b09ef64c1b6a7346"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a348f63883ab1ea70b09ef64c1b6a7346"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a348f63883ab1ea70b09ef64c1b6a7346">activate</a> (void)</td></tr>
<tr class="memdesc:a348f63883ab1ea70b09ef64c1b6a7346"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lets the gyro correct readings. <br/></td></tr>
<tr class="memitem:a181a493d95d37309d3618cab02ea863c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a181a493d95d37309d3618cab02ea863c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a181a493d95d37309d3618cab02ea863c">activateGyroOnly</a> (void)</td></tr>
<tr class="memdesc:a181a493d95d37309d3618cab02ea863c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Activates it and puts it in gyro only mode. <br/></td></tr>
<tr class="memitem:afcb9db5ed1efd9206d0574c30c44fd75"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afcb9db5ed1efd9206d0574c30c44fd75"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#afcb9db5ed1efd9206d0574c30c44fd75">ArAnalogGyro</a> (<a class="el" href="classArRobot.html">ArRobot</a> *robot)</td></tr>
<tr class="memdesc:afcb9db5ed1efd9206d0574c30c44fd75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor. <br/></td></tr>
<tr class="memitem:a952a03f5014a7df96bf26affeb5bcbde"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a952a03f5014a7df96bf26affeb5bcbde"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a952a03f5014a7df96bf26affeb5bcbde">deactivate</a> (void)</td></tr>
<tr class="memdesc:a952a03f5014a7df96bf26affeb5bcbde"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the gyro from correcting readings (still accumulates) <br/></td></tr>
<tr class="memitem:a8b2789ea6b66d06a23a39a6ed6d8318d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8b2789ea6b66d06a23a39a6ed6d8318d"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a8b2789ea6b66d06a23a39a6ed6d8318d">getAverage</a> (void) const </td></tr>
<tr class="memdesc:a8b2789ea6b66d06a23a39a6ed6d8318d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the most recently calculated average rotational velocity (over one. <br/></td></tr>
<tr class="memitem:aa6b554cbebb933a4ac40d994d79e33fc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa6b554cbebb933a4ac40d994d79e33fc"></a>
<a class="el" href="classArTime.html">ArTime</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#aa6b554cbebb933a4ac40d994d79e33fc">getAverageTaken</a> (void) const </td></tr>
<tr class="memdesc:aa6b554cbebb933a4ac40d994d79e33fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the time the last average was taken. <br/></td></tr>
<tr class="memitem:a09b59b5296ee7a23a13ccc708924fe55"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a09b59b5296ee7a23a13ccc708924fe55"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a09b59b5296ee7a23a13ccc708924fe55">getHeading</a> (void) const </td></tr>
<tr class="memdesc:a09b59b5296ee7a23a13ccc708924fe55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets a heading calculated from past gyro readings. <br/></td></tr>
<tr class="memitem:ad70f6c7696a987ef7cf61f191d5683d3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad70f6c7696a987ef7cf61f191d5683d3"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#ad70f6c7696a987ef7cf61f191d5683d3">getPacCount</a> (void)</td></tr>
<tr class="memdesc:ad70f6c7696a987ef7cf61f191d5683d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the number of readings taken in the last second. <br/></td></tr>
<tr class="memitem:a78a487966ec9c1b29ac64411179b8b33"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a78a487966ec9c1b29ac64411179b8b33"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a78a487966ec9c1b29ac64411179b8b33">getScalingFactor</a> (void) const </td></tr>
<tr class="memdesc:a78a487966ec9c1b29ac64411179b8b33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the scaling factor used for multiplying the reading values received (default 1.626) <br/></td></tr>
<tr class="memitem:aef6791135cfab49f24ebd05bf39a4775"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aef6791135cfab49f24ebd05bf39a4775"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#aef6791135cfab49f24ebd05bf39a4775">getTemperature</a> (void) const </td></tr>
<tr class="memdesc:aef6791135cfab49f24ebd05bf39a4775"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the temperature the gyro has. <br/></td></tr>
<tr class="memitem:af2be799c353c1dfc70a300506513a5c9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af2be799c353c1dfc70a300506513a5c9"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#af2be799c353c1dfc70a300506513a5c9">hasGyroOnlyMode</a> (void)</td></tr>
<tr class="memdesc:af2be799c353c1dfc70a300506513a5c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">If we have a gyro only mode. <br/></td></tr>
<tr class="memitem:a787910e4d8d9f0d4da8bb0d9dbdca3d8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a787910e4d8d9f0d4da8bb0d9dbdca3d8"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a787910e4d8d9f0d4da8bb0d9dbdca3d8">hasNoInternalData</a> (void)</td></tr>
<tr class="memdesc:a787910e4d8d9f0d4da8bb0d9dbdca3d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">If this class actually has data or not (if it has no data, the robot is all there is) <br/></td></tr>
<tr class="memitem:ad1559bf0dde0d49880814a150ab0e5a8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad1559bf0dde0d49880814a150ab0e5a8"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>haveData</b> ()</td></tr>
<tr class="memitem:ae1b9bf579a6c3c93fb14a1993221515f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae1b9bf579a6c3c93fb14a1993221515f"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#ae1b9bf579a6c3c93fb14a1993221515f">haveGottenData</a> (void)</td></tr>
<tr class="memdesc:ae1b9bf579a6c3c93fb14a1993221515f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if any amount of gyro data has yet been received, false if no readings have yet been received from the robot. <br/></td></tr>
<tr class="memitem:aa52421c328826c1bffe9a2dac22c189c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa52421c328826c1bffe9a2dac22c189c"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#aa52421c328826c1bffe9a2dac22c189c">isActive</a> (void)</td></tr>
<tr class="memdesc:aa52421c328826c1bffe9a2dac22c189c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets if we really have a gyro or not. <br/></td></tr>
<tr class="memitem:a592159b97420b2a3734aaa2678c7d191"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a592159b97420b2a3734aaa2678c7d191"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#a592159b97420b2a3734aaa2678c7d191">isGyroOnlyActive</a> (void)</td></tr>
<tr class="memdesc:a592159b97420b2a3734aaa2678c7d191"><td class="mdescLeft">&#160;</td><td class="mdescRight">If we're using gyro only mode. <br/></td></tr>
<tr class="memitem:adf79bb9ba052a50318737c5346f6ea1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#adf79bb9ba052a50318737c5346f6ea1a">setFilterModel</a> (double gyroSigma, double inertialVar, double rotVar, double transVar)</td></tr>
<tr class="memdesc:adf79bb9ba052a50318737c5346f6ea1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the parameters of the Kalman filter model.  <a href="#adf79bb9ba052a50318737c5346f6ea1a"></a><br/></td></tr>
<tr class="memitem:aea926050ec8475bb5bb00285accfbebb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aea926050ec8475bb5bb00285accfbebb"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#aea926050ec8475bb5bb00285accfbebb">setLogAnomalies</a> (bool logAnomalies)</td></tr>
<tr class="memdesc:aea926050ec8475bb5bb00285accfbebb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets whether we log anomalies or not (temporary function for debugging) <br/></td></tr>
<tr class="memitem:afdd085205f33f012913cf2fc46d4b5dd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afdd085205f33f012913cf2fc46d4b5dd"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#afdd085205f33f012913cf2fc46d4b5dd">setScalingFactor</a> (double factor)</td></tr>
<tr class="memdesc:afdd085205f33f012913cf2fc46d4b5dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the scaling factor used for multiplying the readings. <br/></td></tr>
<tr class="memitem:adcadb27031049ae191f31164a4ddc412"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adcadb27031049ae191f31164a4ddc412"></a>
virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classArAnalogGyro.html#adcadb27031049ae191f31164a4ddc412">~ArAnalogGyro</a> ()</td></tr>
<tr class="memdesc:adcadb27031049ae191f31164a4ddc412"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor. <br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Use onboard gyro to improve the heading in an <a class="el" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> object's pose value. </p>
<p>The gyro is an accessory connected to the robot's microcontroller. The gyro's purpose is to improve large errors due to wheel slippage, wheels coming off the ground, and other factors like this (or for the skid steer of an AT). The gyro also happens to provide temperature readings as well.</p>
<p>When an <a class="el" href="classArAnalogGyro.html" title="Use onboard gyro to improve the heading in an ArRobot object&#39;s pose value.">ArAnalogGyro</a> object is created, it registers callbacks with the robot, and automatic heading correction will begin when new data arrives from the robot. If you delete the object, it will remove itself from the robot.</p>
<p>The readings come back from the gyro over the robot microcontroller's analog ports. The microcontroller then sends the readings to us just before sending us the standard packet. <a class="el" href="classArAnalogGyro.html" title="Use onboard gyro to improve the heading in an ArRobot object&#39;s pose value.">ArAnalogGyro</a> uses these readings to calculate a better heading of the robot (integrating the velocities to give position). Then when the standard packet comes in, <a class="el" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> calls an encoder correction callback in <a class="el" href="classArAnalogGyro.html" title="Use onboard gyro to improve the heading in an ArRobot object&#39;s pose value.">ArAnalogGyro</a> which does a simple Kalman filter and fuses the encoder information's heading with the gyro's heading to compute the most probable heading which it then returns to the <a class="el" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> object to use as its heading.</p>
<p>The robot's normal dead reconing angle is fairly good if you have properly inflated tires (if you have pneumatic tires) and if you have the revcount parameter sent correctly. See the robot operation manual for how to change the revcount parameter.</p>
<p>Gyro readings are affected by temperature (a temperature value is reported along with the gyro data in the packets from the microcontroller). The gyro will auto calibrate itself to the center of the range (which may have drifted due to temperature) whenever the robot is stationary for more than one second (that is, if its translational and rotational velocities are less than 1 and if the gyro readings are also within .5% of the average). The scaling factor (between change of voltage and amount of turn) doesn't seem to change due to temperature, though it can vary among different gyro devices. (This scaling factor can be accessed with <a class="el" href="classArAnalogGyro.html#a78a487966ec9c1b29ac64411179b8b33" title="Gets the scaling factor used for multiplying the reading values received (default 1...">getScalingFactor()</a> and <a class="el" href="classArAnalogGyro.html#afdd085205f33f012913cf2fc46d4b5dd" title="Sets the scaling factor used for multiplying the readings.">setScalingFactor()</a>.) The default value used here was within 3% of correct most of the time. The default resides in the parameter file for the robot that is loaded or used when a connection is made. If you want to tune this more you can, by finding a different scale factor. (There is just one so there doesn't have to be alot of calibration in flash that is lost if parameters are loaded from a file.)</p>
<p>General notes on gyros and inertial correction: The purpose of the gyro is to correct for wheel slippage and large errors. It is not to totally correct for all errors, but to bring the errors into smaller zones that software can correct for more easily (such as by localization). We have found that if gyros or inertial measurement devices are used to attempt to correct for all error, the result can be not very robust, and include many problematic assumptions. For this reason, we have found that it is best to integrate this one simple gyro to simply improve robot odometry, rather than a complicated and expensive IMU. </p>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="demo_8cpp-example.html#_a10">demo.cpp</a>, <a class="el" href="gotoActionExample_8cpp-example.html#_a4">gotoActionExample.cpp</a>, and <a class="el" href="gyroExample_8cpp-example.html#_a2">gyroExample.cpp</a>.</dd>
</dl></div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="adf79bb9ba052a50318737c5346f6ea1a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ArAnalogGyro::setFilterModel </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>gyroSigma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>inertialVar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rotVar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>transVar</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the parameters of the Kalman filter model. </p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">gyroSigma</td><td>the amount its off statically</td></tr>
    <tr><td class="paramname">inertialVar</td><td>the proportional amount it is off</td></tr>
    <tr><td class="paramname">rotVar</td><td>the amount the rotation is off proportionally</td></tr>
    <tr><td class="paramname">transVar</td><td>the amount the translation throws off the heading proportionally </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>ArAnalogGyro.h</li>
<li>ArAnalogGyro.cpp</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classArAnalogGyro.html">ArAnalogGyro</a></li>
    <li class="footer">Generated on Wed Nov 15 2017 12:04:24 for Aria by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
