<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Aria: imuExample.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Aria
   &#160;<span id="projectnumber">2.9.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('imuExample_8cpp-example.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">imuExample.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example of gathering IMU data from Seekur Sample program that demonstrates how to get IMU data from an IMU on a Seekur-class robot (from SeekurOS). Only some Seekurs have IMUs.</p>
<p>[Some Pioneers also have gyros that are integrated into the robot and normally automatically correct data or which can optionally return the data seperately (using different packets and different ARIA interface in <a class="el" href="classArAnalogGyro.html" title="Use onboard gyro to improve the heading in an ArRobot object&#39;s pose value.">ArAnalogGyro</a>).]</p>
<p>The data comes back in a custom packet with ID 0x9A. It's requested with client command 26.</p>
<p>Press escape to exit the program.</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;Aria.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArSeekurIMU.h&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div>
<div class="line">  <a name="a0"></a><a class="code" href="classAria.html#ad99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including adding OS sign...">Aria::init</a>();</div>
<div class="line">  <a name="_a1"></a><a class="code" href="classArArgumentParser.html" title="Parse and store program command-line arguments for use by other ARIA classes.">ArArgumentParser</a> parser(&amp;argc, argv);</div>
<div class="line">  parser.<a name="a2"></a><a class="code" href="classArArgumentParser.html#a501694b62a7f8b0c3cadd84aeafe1b35" title="Adds args from default files and environmental variables.">loadDefaultArguments</a>();</div>
<div class="line">  <a name="_a3"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;</div>
<div class="line">  <a name="_a4"></a><a class="code" href="classArSeekurIMU.html" title="Access extra data provided by optional Seekur IMU.">ArSeekurIMU</a> imu(&amp;robot);</div>
<div class="line"></div>
<div class="line">  <a name="_a5"></a><a class="code" href="classArRobotConnector.html" title="Connect to robot or simulator based on program command line parameters.">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);</div>
<div class="line">  <span class="keywordflow">if</span>(!robotConnector.<a name="a6"></a><a class="code" href="classArRobotConnector.html#ab192ac393d9cc1e5b61b1a82b08d085d" title="Sets up the robot then connects it.">connectRobot</a>())</div>
<div class="line">  {</div>
<div class="line">    <a name="a7"></a><a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a8"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;imuExample: Could not connect to the robot.&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span>(parser.<a name="a9"></a><a class="code" href="classArArgumentParser.html#ac3889cbdfa862031c51bf80e06954914" title="Checks for the help strings and warns about unparsed arguments.">checkHelpAndWarnUnparsed</a>())</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// -help not given</span></div>
<div class="line">        <a name="a10"></a><a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();</div>
<div class="line">        <a name="a11"></a><a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (!<a name="a12"></a><a class="code" href="classAria.html#a1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())">Aria::parseArgs</a>() || !parser.<a class="code" href="classArArgumentParser.html#ac3889cbdfa862031c51bf80e06954914" title="Checks for the help strings and warns about unparsed arguments.">checkHelpAndWarnUnparsed</a>())</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classAria.html#a10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())">Aria::logOptions</a>();</div>
<div class="line">    <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a13"></a><a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;imuExample: Connected to robot.&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <a name="_a14"></a><a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a> keyHandler;</div>
<div class="line">  <a name="a15"></a><a class="code" href="classAria.html#a9e5496a4ec2c379c8e18706922b57cc1" title="Sets the key handler, so that other classes can find it using getKeyHandler()">Aria::setKeyHandler</a>(&amp;keyHandler);</div>
<div class="line">  robot.<a name="a16"></a><a class="code" href="classArRobot.html#ab4ea516667d2358f35b435d97b616ab1" title="Attachs a key handler.">attachKeyHandler</a>(&amp;keyHandler);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Run robot cycle in background thread</span></div>
<div class="line">  robot.<a name="a17"></a><a class="code" href="classArRobot.html#a3c3d878cfd11a2ef91230005a83bfcaa" title="Starts the instance to do processing in its own new thread.">runAsync</a>(<span class="keyword">true</span>);</div>
<div class="line">  <a name="a18"></a><a class="code" href="group__easy.html#ga4dfb878a3f9123b8dd96ae05b2fd94cb" title="Sleep for the given number of milliseconds.">ArUtil::sleep</a>(500);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Check whether robot firmware thinks it has an IMU</span></div>
<div class="line">  robot.<a name="a19"></a><a class="code" href="classArRobot.html#a5aecc7ac998c9a31b82fdb904efa8609" title="Lock the robot instance.">lock</a>();</div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">  if (!robot.getOrigRobotConfig()-&gt;getHasGyro())</span></div>
<div class="line"><span class="comment">  {</span></div>
<div class="line"><span class="comment">    ArLog::log(ArLog::Terse, &quot;imuExample: Robot firmware indicates gyro/imu disabled! (See HasGyro and/or GyroType parameter)&quot;);</span></div>
<div class="line"><span class="comment">    robot.unlock();</span></div>
<div class="line"><span class="comment">    Aria::exit(1);</span></div>
<div class="line"><span class="comment">    return 1;</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line">  <span class="keywordtype">int</span> gyroType = robot.<a name="a20"></a><a class="code" href="classArRobot.html#abd59593d76f616951dc77110e55802f5" title="Gets the original robot config packet information.">getOrigRobotConfig</a>()-&gt;<a name="a21"></a><a class="code" href="classArRobotConfigPacketReader.html#a653af1e768e4944c5181857e4ce0bded" title="Returns if the robot has a gyro or not.">getGyroType</a>();</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> *gyroTypeDescr = <span class="stringliteral">&quot;UNRECOGNIZED VALUE&quot;</span>;</div>
<div class="line">  <span class="keywordflow">switch</span>(gyroType)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">case</span> 0:</div>
<div class="line">      gyroTypeDescr = <span class="stringliteral">&quot;Disabled/No Gyro&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> 1:</div>
<div class="line">      gyroTypeDescr = <span class="stringliteral">&quot;Pioneer3 Gyro Data&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> 2:</div>
<div class="line">      gyroTypeDescr = <span class="stringliteral">&quot;Pioneer3 Gyro Auto&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> 3:</div>
<div class="line">      gyroTypeDescr = <span class="stringliteral">&quot;Seekur/SeekurJr Single Axis Gyro&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> 4:</div>
<div class="line">      gyroTypeDescr = <span class="stringliteral">&quot;Seekur/SeekurJr IMU&quot;</span>;</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">      <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;imuExample: Unrecognized GyroType value %d!&quot;</span>, gyroType);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a7040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">&quot;imuExample: Robot firmware reports GyroType=%d (%s)&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span>(gyroType != 4)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classArLog.html#a43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#ac8cc0fb3aa323ab2a1c21340fdd1dce3a012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">&quot;imuExample: Robot firmware configuration paramater GyroType=%d (%s). Cannot get IMU data with this GyroType, need GyroType 4.&quot;</span>, gyroType, gyroTypeDescr);</div>
<div class="line">    robot.<a name="a22"></a><a class="code" href="classArRobot.html#a403d9de010dc2b8d478cd0b14b2d9491" title="Unlock the robot instance.">unlock</a>();</div>
<div class="line">    <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  robot.<a class="code" href="classArRobot.html#a403d9de010dc2b8d478cd0b14b2d9491" title="Unlock the robot instance.">unlock</a>();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//       x   y   z   ax  ay  az  px  py  pz t</span></div>
<div class="line">  printf(<span class="stringliteral">&quot;%6s %6s %6s %6s %6s %6s %6s %6s %6s %6s\n&quot;</span>, </div>
<div class="line">          <span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;y&quot;</span>, <span class="stringliteral">&quot;z&quot;</span>, <span class="stringliteral">&quot;ax&quot;</span>, <span class="stringliteral">&quot;ay&quot;</span>, <span class="stringliteral">&quot;az&quot;</span>, <span class="stringliteral">&quot;px&quot;</span>, <span class="stringliteral">&quot;py&quot;</span>, <span class="stringliteral">&quot;pz&quot;</span>, <span class="stringliteral">&quot;t&quot;</span>);</div>
<div class="line">  <span class="keywordflow">while</span> (robot.<a name="a23"></a><a class="code" href="group__easy.html#ga98b5d608fb9f33aec47a3fe1995dc5b6" title="Questions whether the robot is connected or not.">isConnected</a>())</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">//sholud do this from a SensorInterpTask</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;%4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f \r&quot;</span>,</div>
<div class="line">      imu.<a name="a24"></a>getXSpeed(),</div>
<div class="line">      imu.<a name="a25"></a>getYSpeed(),</div>
<div class="line">      imu.<a name="a26"></a>getZSpeed(),</div>
<div class="line">      imu.<a name="a27"></a>getXAccel(),</div>
<div class="line">      imu.<a name="a28"></a>getYAccel(),</div>
<div class="line">      imu.<a name="a29"></a>getZAccel(),</div>
<div class="line">      imu.<a name="a30"></a>getXPos(),</div>
<div class="line">      imu.<a name="a31"></a>getYPos(),</div>
<div class="line">      imu.<a name="a32"></a>getZPos(),</div>
<div class="line">      imu.<a name="a33"></a><a class="code" href="classArSeekurIMU.html#a59d4cb2d757dc9fb90ff0ac0cbb03494" title="Gets the average temperature the IMU has on all axes.">getTemperature</a>()</div>
<div class="line">    );</div>
<div class="line">    <a class="code" href="group__easy.html#ga4dfb878a3f9123b8dd96ae05b2fd94cb" title="Sleep for the given number of milliseconds.">ArUtil::sleep</a>(100);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="classAria.html#a6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);</div>
<div class="line">}</div>
<div class="line">             </div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 15 2017 12:04:23 for Aria by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
