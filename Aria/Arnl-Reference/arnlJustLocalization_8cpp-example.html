<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ARNL: arnlJustLocalization.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ARNL
   &#160;<span id="projectnumber">1.9.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('arnlJustLocalization_8cpp-example.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">arnlJustLocalization.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>example server that performs ARNL laser localization but no navigation or path planning.</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;Aria.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArNetworking.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Arnl.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArLocalizationTask.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArDocking.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;ArSystemStatus.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> logOptions(<span class="keyword">const</span> <span class="keywordtype">char</span> *progname)</div>
<div class="line">{</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Usage: %s [options]\n&quot;</span>, progname);</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;[options] are any program options listed below, or any ARNL configuration&quot;</span>);</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;parameters as -name &lt;value&gt;, see params/arnl.p for list.&quot;</span>);</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;For example, -map &lt;map file&gt;.&quot;</span>);</div>
<div class="line">  Aria::logOptions();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> gyroErrored = <span class="keyword">false</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* getGyroStatusString(ArRobot* robot)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(!robot || !robot-&gt;getOrigRobotConfig() || robot-&gt;getOrigRobotConfig()-&gt;getGyroType() &lt; 2) <span class="keywordflow">return</span> <span class="stringliteral">&quot;N/A&quot;</span>;</div>
<div class="line">  <span class="keywordflow">if</span>(robot-&gt;getFaultFlags() &amp; ArUtil::BIT4)</div>
<div class="line">  {</div>
<div class="line">    gyroErrored = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;ERROR/OFF&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>(gyroErrored)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;OK but error before&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> <span class="stringliteral">&quot;OK&quot;</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// This function is called if localization fails. It will be attached </span></div>
<div class="line"><span class="comment">// to the localization task below in main() via</span></div>
<div class="line"><span class="comment">// ArLocalizationTask::setFailedCallback()</span></div>
<div class="line"><span class="keywordtype">void</span> locFailed(<span class="keywordtype">int</span> n) <span class="comment">//, ArLocalizationTask* locTask)</span></div>
<div class="line">{</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;ARNL server example: localization failed&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> handleDebugMessage(ArRobotPacket *pkt)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(pkt-&gt;getID() != ArCommands::MARCDEBUG) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">  <span class="keywordtype">char</span> msg[256];</div>
<div class="line">  pkt-&gt;bufToStr(msg, <span class="keyword">sizeof</span>(msg));</div>
<div class="line">  msg[255] = 0;</div>
<div class="line">  ArLog::log(ArLog::Terse, <span class="stringliteral">&quot;Controller Firmware: %s&quot;</span>, msg);</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Initialize Aria and Arnl global information</span></div>
<div class="line">  Aria::init();</div>
<div class="line">  Arnl::init();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// You can change default ArLog options in this call, but the settings in the parameter file</span></div>
<div class="line">  <span class="comment">// (arnl.p) which is loaded below (Aria::getConfig()-&gt;parseFile())  will override the options.</span></div>
<div class="line">  <span class="comment">//ArLog::init(ArLog::File, ArLog::Normal, &quot;log.txt&quot;, true, true);</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Used to parse the command line arguments.</span></div>
<div class="line">  ArArgumentParser parser(&amp;argc, argv);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load default arguments for this computer (from /etc/Aria.args, environment</span></div>
<div class="line">  <span class="comment">// variables, and other places)</span></div>
<div class="line">  parser.loadDefaultArguments();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Tell the laser connector to always connect the first laser since</span></div>
<div class="line">  <span class="comment">// this program always requires a laser.</span></div>
<div class="line">  parser.addDefaultArgument(<span class="stringliteral">&quot;-connectLaser&quot;</span>);</div>
<div class="line"></div>
<div class="line">  </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// The robot object</span></div>
<div class="line">  ArRobot robot;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// handle messages from robot controller firmware and log the contents</span></div>
<div class="line">  robot.addPacketHandler(<span class="keyword">new</span> ArGlobalRetFunctor1&lt;bool, ArRobotPacket*&gt;(&amp;handleDebugMessage));</div>
<div class="line"></div>
<div class="line">  <span class="comment">// This object is used to connect to the robot, which can be configured via</span></div>
<div class="line">  <span class="comment">// command line arguments.</span></div>
<div class="line">  ArRobotConnector robotConnector(&amp;parser, &amp;robot);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Connect to the robot</span></div>
<div class="line">  <span class="keywordflow">if</span> (!robotConnector.connectRobot())</div>
<div class="line">  {</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Error: Could not connect to robot... exiting&quot;</span>);</div>
<div class="line">    Aria::exit(3);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set up where we&#39;ll look for files. Arnl::init() set Aria&#39;s default</span></div>
<div class="line">  <span class="comment">// directory to Arnl&#39;s default directory; addDirectories() appends this</span></div>
<div class="line">  <span class="comment">// &quot;examples&quot; directory.</span></div>
<div class="line">  <span class="keywordtype">char</span> fileDir[1024];</div>
<div class="line">  ArUtil::addDirectories(fileDir, <span class="keyword">sizeof</span>(fileDir), Aria::getDirectory(), </div>
<div class="line">             <span class="stringliteral">&quot;examples&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  </div>
<div class="line">  <span class="comment">// To direct log messages to a file, or to change the log level, use these  calls:</span></div>
<div class="line">  <span class="comment">//ArLog::init(ArLog::File, ArLog::Normal, &quot;log.txt&quot;, true, true);</span></div>
<div class="line">  <span class="comment">//ArLog::init(ArLog::File, ArLog::Verbose);</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add a section to the configuration to change ArLog parameters</span></div>
<div class="line">  ArLog::addToConfig(Aria::getConfig());</div>
<div class="line"></div>
<div class="line">  <span class="comment">// set up a gyro (if the robot is older and its firmware does not</span></div>
<div class="line">  <span class="comment">// automatically incorporate gyro corrections, then this object will do it)</span></div>
<div class="line">  ArAnalogGyro gyro(&amp;robot);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Our networking server</span></div>
<div class="line">  ArServerBase server;</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set up our simpleOpener, used to set up the networking server</span></div>
<div class="line">  ArServerSimpleOpener simpleOpener(&amp;parser);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// the laser connector</span></div>
<div class="line">  ArLaserConnector laserConnector(&amp;parser, &amp;robot, &amp;robotConnector);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// used to connect to camera PTZ control</span></div>
<div class="line">  ArPTZConnector ptzConnector(&amp;parser, &amp;robot);</div>
<div class="line"></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Load default arguments for this computer (from /etc/Aria.args, environment</span></div>
<div class="line">  <span class="comment">// variables, and other places)</span></div>
<div class="line">  parser.loadDefaultArguments();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Parse arguments </span></div>
<div class="line">  <span class="keywordflow">if</span> (!Aria::parseArgs() || !parser.checkHelpAndWarnUnparsed())</div>
<div class="line">  {</div>
<div class="line">    logOptions(argv[0]);</div>
<div class="line">    Aria::exit(1);</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">// This causes Aria::exit(9) to be called if the robot unexpectedly</span></div>
<div class="line">  <span class="comment">// disconnects</span></div>
<div class="line">  ArGlobalFunctor1&lt;int&gt; shutdownFunctor(&amp;Aria::exit, 9);</div>
<div class="line">  robot.addDisconnectOnErrorCB(&amp;shutdownFunctor);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Create an ArSonarDevice object (ArRangeDevice subclass) and </span></div>
<div class="line">  <span class="comment">// connect it to the robot.</span></div>
<div class="line">  ArSonarDevice sonarDev;</div>
<div class="line">  robot.addRangeDevice(&amp;sonarDev);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// This object will allow robot&#39;s movement parameters to be changed through</span></div>
<div class="line">  <span class="comment">// a Robot Configuration section in the ArConfig global configuration facility.</span></div>
<div class="line">  ArRobotConfig robotConfig(&amp;robot);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Include gyro configuration options in the robot configuration section.</span></div>
<div class="line">  robotConfig.addAnalogGyro(&amp;gyro);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Start the robot thread.</span></div>
<div class="line">  robot.runAsync(<span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">// connect the laser(s) if it was requested, this adds them to the</span></div>
<div class="line">  <span class="comment">// robot too, and starts them running in their own threads</span></div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Connecting to laser(s) configured in parameters...&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (!laserConnector.connectLasers())</div>
<div class="line">  {</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Error: Could not connect to laser(s). Exiting.&quot;</span>);</div>
<div class="line">    Aria::exit(2);</div>
<div class="line">  }</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Done connecting to laser(s).&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// find the laser we should use for localization and/or mapping,</span></div>
<div class="line">  <span class="comment">// which will be the first laser</span></div>
<div class="line">  robot.lock();</div>
<div class="line">  ArLaser *firstLaser = robot.findLaser(1);</div>
<div class="line">  <span class="keywordflow">if</span> (firstLaser == NULL || !firstLaser-&gt;isConnected())</div>
<div class="line">  {</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Did not have laser 1 or it is not connected, cannot start localization and/or mapping... exiting&quot;</span>);</div>
<div class="line">    Aria::exit(2);</div>
<div class="line">  }</div>
<div class="line">  robot.unlock();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create and set up map object */</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Set up the map object, this will look for files in the examples</span></div>
<div class="line">  <span class="comment">// directory (unless the file name starts with a /, \, or .</span></div>
<div class="line">  <span class="comment">// You can take out the &#39;fileDir&#39; argument to look in the program&#39;s current directory</span></div>
<div class="line">  <span class="comment">// instead.</span></div>
<div class="line">  <span class="comment">// When a configuration file is loaded into ArConfig later, if it specifies a</span></div>
<div class="line">  <span class="comment">// map file, then that file will be loaded as the map.</span></div>
<div class="line">  ArMap map(fileDir);</div>
<div class="line">  <span class="comment">// set it up to ignore empty file names (otherwise if a configuration omits</span></div>
<div class="line">  <span class="comment">// the map file, the whole configuration change will fail)</span></div>
<div class="line">  map.setIgnoreEmptyFileName(<span class="keyword">true</span>);</div>
<div class="line">  <span class="comment">// ignore the case, so that if someone is using MobileEyes or</span></div>
<div class="line">  <span class="comment">// MobilePlanner from Windows and changes the case on a map name,</span></div>
<div class="line">  <span class="comment">// it will still work.</span></div>
<div class="line">  map.setIgnoreCase(<span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    <span class="comment">/* Create localization threads */</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Creating laser localization task&quot;</span>);</div>
<div class="line">  <a name="_a0"></a><a class="code" href="classArLocalizationTask.html" title="Task that performs continuous localization of the robot with a laser range sensor in a seperate async...">ArLocalizationTask</a> locTask(&amp;robot, firstLaser, &amp;map);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// A callback function, which is called if localization fails</span></div>
<div class="line">  ArGlobalFunctor1&lt;int&gt; locFailedCB(&amp;locFailed);</div>
<div class="line">  locTask.setFailedCallBack(&amp;locFailedCB); <span class="comment">//, &amp;locTask);</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set some options  and callbacks on each laser that the laser connector </span></div>
<div class="line">  <span class="comment">// connected to.</span></div>
<div class="line">  std::map&lt;int, ArLaser *&gt;::iterator laserIt;</div>
<div class="line">  <span class="keywordflow">for</span> (laserIt = robot.getLaserMap()-&gt;begin();</div>
<div class="line">       laserIt != robot.getLaserMap()-&gt;end();</div>
<div class="line">       laserIt++)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">int</span> laserNum = (*laserIt).first;</div>
<div class="line">    ArLaser *laser = (*laserIt).second;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Skip lasers that aren&#39;t connected</span></div>
<div class="line">    <span class="keywordflow">if</span>(!laser-&gt;isConnected())</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add the disconnectOnError CB to shut things down if the laser</span></div>
<div class="line">    <span class="comment">// connection is lost</span></div>
<div class="line">    laser-&gt;addDisconnectOnErrorCB(&amp;shutdownFunctor);</div>
<div class="line">    <span class="comment">// set the number of cumulative readings the laser will take</span></div>
<div class="line">    laser-&gt;setCumulativeBufferSize(200);</div>
<div class="line">    <span class="comment">// set the cumulative clean offset (so that they don&#39;t all fire at once)</span></div>
<div class="line">    laser-&gt;setCumulativeCleanOffset(laserNum * 100);</div>
<div class="line">    <span class="comment">// reset the cumulative clean time (to make the new offset take effect)</span></div>
<div class="line">    laser-&gt;resetLastCumulativeCleanTime();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Add the packet count to the Aria info strings (It will be included in</span></div>
<div class="line">    <span class="comment">// MobileEyes custom details so you can monitor whether the laser data is</span></div>
<div class="line">    <span class="comment">// being received correctly)</span></div>
<div class="line">    std::string laserPacketCountName;</div>
<div class="line">    laserPacketCountName = laser-&gt;getName();</div>
<div class="line">    laserPacketCountName += <span class="stringliteral">&quot; Packet Count&quot;</span>;</div>
<div class="line">    Aria::getInfoGroup()-&gt;addStringInt(</div>
<div class="line">        laserPacketCountName.c_str(), 10, </div>
<div class="line">        <span class="keyword">new</span> ArRetFunctorC&lt;int, ArLaser&gt;(laser, </div>
<div class="line">                     &amp;ArLaser::getReadingCount));</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Start the server */</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Open the networking server</span></div>
<div class="line">  <span class="keywordflow">if</span> (!simpleOpener.open(&amp;server, fileDir, 240))</div>
<div class="line">  {</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Error: Could not open server.&quot;</span>);</div>
<div class="line">    exit(2);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create various services that provide network access to clients (such as</span></div>
<div class="line"><span class="comment">     * MobileEyes), as well as add various additional features to ARNL */</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  robot.unlock();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Service to provide drawings of data in the map display :</span></div>
<div class="line">  ArServerInfoDrawings drawings(&amp;server);</div>
<div class="line">  drawings.addRobotsRangeDevices(&amp;robot);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Show the sample points used by MCL */</span></div>
<div class="line">  ArDrawingData drawingDataL(<span class="stringliteral">&quot;polyDots&quot;</span>, ArColor(0,255,0), 100, 75);</div>
<div class="line">  ArFunctor2C&lt;ArLocalizationTask, ArServerClient *, ArNetPacket *&gt; </div>
<div class="line">    drawingFunctorL(&amp;locTask, &amp;<a name="a1"></a><a class="code" href="classArLocalizationTask.html#a106eada91144e31e6c9999f2130bb98f" title="Draws range data used for localization.">ArLocalizationTask::drawRangePoints</a>);</div>
<div class="line">  drawings.addDrawing(&amp;drawingDataL, <span class="stringliteral">&quot;Localization Points&quot;</span>, &amp;drawingFunctorL);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// &quot;Custom&quot; commands. You can add your own custom commands here, they will</span></div>
<div class="line">  <span class="comment">// be available in MobileEyes&#39; custom commands (enable in the toolbar or</span></div>
<div class="line">  <span class="comment">// access through Robot Tools)</span></div>
<div class="line">  ArServerHandlerCommands commands(&amp;server);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// These provide various kinds of information to the client:</span></div>
<div class="line">  ArServerInfoRobot serverInfoRobot(&amp;server, &amp;robot);</div>
<div class="line">  ArServerInfoSensor serverInfoSensor(&amp;server, &amp;robot);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Provides localization info and allows the client (MobileEyes) to relocalize at a given</span></div>
<div class="line">  <span class="comment">// pose:</span></div>
<div class="line">  <a name="_a2"></a><a class="codeRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArServerInfoLocalization.html">ArServerInfoLocalization</a> serverInfoLocalization(&amp;server, &amp;robot, &amp;locTask);</div>
<div class="line">  <a name="_a3"></a><a class="codeRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArServerHandlerLocalization.html">ArServerHandlerLocalization</a> serverLocHandler(&amp;server, &amp;robot, &amp;locTask);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// If you&#39;re using MobileSim, ArServerHandlerLocalization sends it a command</span></div>
<div class="line">  <span class="comment">// to move the robot&#39;s true pose if you manually do a localization through </span></div>
<div class="line">  <span class="comment">// MobileEyes.  To disable that behavior, use this constructor call instead:</span></div>
<div class="line">  <span class="comment">// ArServerHandlerLocalization serverLocHandler(&amp;server, &amp;robot, true, false);</span></div>
<div class="line">  <span class="comment">// The fifth argument determines whether to send the command to MobileSim.</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Provide the map to the client (and related controls):</span></div>
<div class="line">  ArServerHandlerMap serverMap(&amp;server, &amp;map);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// These objects add some simple (custom) commands to &#39;commands&#39; for testing and debugging:</span></div>
<div class="line">  ArServerSimpleComUC uCCommands(&amp;commands, &amp;robot);                   <span class="comment">// Send any command to the microcontroller</span></div>
<div class="line">  ArServerSimpleComMovementLogging loggingCommands(&amp;commands, &amp;robot); <span class="comment">// configure logging</span></div>
<div class="line">  ArServerSimpleComLogRobotConfig configCommands(&amp;commands, &amp;robot);   <span class="comment">// trigger logging of the robot config parameters</span></div>
<div class="line"><span class="comment">//  ArServerSimpleServerCommands serverCommands(&amp;commands, &amp;server);     // monitor networking behavior (track packets sent etc.)</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// service that allows the client to monitor the communication link status</span></div>
<div class="line">  <span class="comment">// between the robot and the client.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  ArServerHandlerCommMonitor handlerCommMonitor(&amp;server);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// service that allows client to change configuration parameters in ArConfig </span></div>
<div class="line">  ArServerHandlerConfig handlerConfig(&amp;server, Aria::getConfig(),</div>
<div class="line">                      Arnl::getTypicalDefaultParamFileName(),</div>
<div class="line">                      Aria::getDirectory());</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// This service causes the client to show simple dialog boxes</span></div>
<div class="line">  ArServerHandlerPopup popupServer(&amp;server);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Set up the possible modes for remote control from a client such as</span></div>
<div class="line"><span class="comment">   * MobileEyes:</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Mode To stop and remain stopped:</span></div>
<div class="line">  ArServerModeStop modeStop(&amp;server, &amp;robot);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Cause the sonar to turn off automatically</span></div>
<div class="line">  <span class="comment">// when the robot is stopped, and turn it back on when commands to move</span></div>
<div class="line">  <span class="comment">// are sent. (Note, if using SONARNL to localize, then don&#39;t do this</span></div>
<div class="line">  <span class="comment">// since localization may get lost)</span></div>
<div class="line">  ArSonarAutoDisabler sonarAutoDisabler(&amp;robot);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Teleoperation modes To drive by keyboard, joystick, etc:</span></div>
<div class="line">  ArServerModeRatioDrive modeRatioDrive(&amp;server, &amp;robot);  </div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Prevent normal teleoperation driving if localization is lost using</span></div>
<div class="line">  <span class="comment">// a high-priority action, which enables itself when the particular mode is</span></div>
<div class="line">  <span class="comment">// active.</span></div>
<div class="line">  <span class="comment">// (You have to enter unsafe drive mode to drive when lost.)</span></div>
<div class="line">  <a name="_a4"></a><a class="codeRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArActionLost.html">ArActionLost</a> actionLostRatioDrive(&amp;locTask, NULL, &amp;modeRatioDrive);</div>
<div class="line">  modeRatioDrive.getActionGroup()-&gt;addAction(&amp;actionLostRatioDrive, 110);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Add drive mode section to the configuration, and also some custom (simple) commands:</span></div>
<div class="line">  modeRatioDrive.addToConfig(Aria::getConfig(), <span class="stringliteral">&quot;Teleop settings&quot;</span>);</div>
<div class="line">  modeRatioDrive.addControlCommands(&amp;commands);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Wander mode (also prevent wandering if lost):</span></div>
<div class="line">  ArServerModeWander modeWander(&amp;server, &amp;robot);</div>
<div class="line">  <a class="codeRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArActionLost.html">ArActionLost</a> actionLostWander(&amp;locTask, NULL, &amp;modeWander);</div>
<div class="line">  modeWander.getActionGroup()-&gt;addAction(&amp;actionLostWander, 110);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Tool to log data periodically to a file</span></div>
<div class="line">  ArDataLogger dataLogger(&amp;robot, <span class="stringliteral">&quot;datalog.txt&quot;</span>);</div>
<div class="line">  dataLogger.addToConfig(Aria::getConfig()); <span class="comment">// make it configurable through ArConfig</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Automatically add anything from the global info group to the data logger.</span></div>
<div class="line">  Aria::getInfoGroup()-&gt;addAddStringCallback(dataLogger.getAddStringFunctor());</div>
<div class="line"></div>
<div class="line">  <span class="comment">// This provides a small table of interesting information for the client</span></div>
<div class="line">  <span class="comment">// to display to the operator. You can add your own callbacks to show any</span></div>
<div class="line">  <span class="comment">// data you want.</span></div>
<div class="line">  ArServerInfoStrings stringInfo(&amp;server);</div>
<div class="line">  Aria::getInfoGroup()-&gt;addAddStringCallback(stringInfo.getAddStringFunctor());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// The following statements add fields to a set of informational data called</span></div>
<div class="line">  <span class="comment">// the InfoGroup. These are served to MobileEyes for displayi (turn on by enabling Details</span></div>
<div class="line">  <span class="comment">// and Custom Details in the View menu of MobileEyes.)</span></div>
<div class="line"></div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringInt(</div>
<div class="line">      <span class="stringliteral">&quot;Motor Packet Count&quot;</span>, 10, </div>
<div class="line">      <span class="keyword">new</span> ArConstRetFunctorC&lt;int, ArRobot&gt;(&amp;robot, </div>
<div class="line">                           &amp;ArRobot::getMotorPacCount));</div>
<div class="line"></div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringDouble(</div>
<div class="line">      <span class="stringliteral">&quot;Laser Localization Score&quot;</span>, 8, </div>
<div class="line">      <span class="keyword">new</span> ArRetFunctorC&lt;double, ArLocalizationTask&gt;(</div>
<div class="line">          &amp;locTask, &amp;<a name="a5"></a><a class="code" href="classArLocalizationTask.html#a17ff3d74dfa7cd4955c284a954e2ba03" title="Gets the higher of MCL and Reflector based localization.">ArLocalizationTask::getLocalizationScore</a>),</div>
<div class="line">      <span class="stringliteral">&quot;%.03f&quot;</span>);</div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringInt(</div>
<div class="line">      <span class="stringliteral">&quot;Laser Loc Num Samples&quot;</span>, 8, </div>
<div class="line">      <span class="keyword">new</span> ArRetFunctorC&lt;int, ArLocalizationTask&gt;(</div>
<div class="line">          &amp;locTask, &amp;<a name="a6"></a><a class="code" href="classArLocalizationTask.html#af05fb6f78dbb52b3937698ef467e3d1a" title="Get the variable number of samples if adjusted during move.">ArLocalizationTask::getCurrentNumSamples</a>),</div>
<div class="line">      <span class="stringliteral">&quot;%4d&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Display gyro status if gyro is enabled and is being handled by the firmware (gyro types 2, 3, or 4).</span></div>
<div class="line">  <span class="comment">// (If the firmware detects an error communicating with the gyro or IMU it</span></div>
<div class="line">  <span class="comment">// returns a flag, and stops using it.)</span></div>
<div class="line">  <span class="comment">// (This gyro type parameter, and fault flag, are only in ARCOS, not Seekur firmware)</span></div>
<div class="line">  <span class="keywordflow">if</span>(robot.getOrigRobotConfig() &amp;&amp; robot.getOrigRobotConfig()-&gt;getGyroType() &gt; 1)</div>
<div class="line">  {</div>
<div class="line">    Aria::getInfoGroup()-&gt;addStringString(</div>
<div class="line">          <span class="stringliteral">&quot;Gyro/IMU Status&quot;</span>, 10,</div>
<div class="line">          <span class="keyword">new</span> ArGlobalRetFunctor1&lt;const char*, ArRobot*&gt;(&amp;getGyroStatusString, &amp;robot)</div>
<div class="line">      );</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Display system CPU and wireless network status</span></div>
<div class="line">  ArSystemStatus::startPeriodicUpdate(1000); <span class="comment">// update every 1 second</span></div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringDouble(<span class="stringliteral">&quot;CPU Use&quot;</span>, 10, ArSystemStatus::getCPUPercentFunctor(), <span class="stringliteral">&quot;% 4.0f%%&quot;</span>);</div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringInt(<span class="stringliteral">&quot;Wireless Link Quality&quot;</span>, 9, ArSystemStatus::getWirelessLinkQualityFunctor(), <span class="stringliteral">&quot;%d&quot;</span>);</div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringInt(<span class="stringliteral">&quot;Wireless Link Noise&quot;</span>, 9, ArSystemStatus::getWirelessLinkNoiseFunctor(), <span class="stringliteral">&quot;%d&quot;</span>);</div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringInt(<span class="stringliteral">&quot;Wireless Signal&quot;</span>, 9, ArSystemStatus::getWirelessLinkSignalFunctor(), <span class="stringliteral">&quot;%d&quot;</span>);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">// stats on how far its driven since software started</span></div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringDouble(<span class="stringliteral">&quot;Distance Travelled (m)&quot;</span>, 20, <span class="keyword">new</span> ArRetFunctorC&lt;double, ArRobot&gt;(&amp;robot, &amp;ArRobot::getOdometerDistanceMeters), <span class="stringliteral">&quot;%.2f&quot;</span>);</div>
<div class="line">  Aria::getInfoGroup()-&gt;addStringDouble(<span class="stringliteral">&quot;Run time (min)&quot;</span>, 20, <span class="keyword">new</span></div>
<div class="line">ArRetFunctorC&lt;double, ArRobot&gt;(&amp;robot, &amp;ArRobot::getOdometerTimeMinutes),</div>
<div class="line"><span class="stringliteral">&quot;%.2f&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Make Stop mode the default (If current mode deactivates without entering</span></div>
<div class="line">  <span class="comment">// a new mode, then Stop Mode will be selected)</span></div>
<div class="line">  modeStop.addAsDefaultMode();</div>
<div class="line">    <span class="comment">// TODO move up near where stop mode is created?</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Services that allow the client to initiate scanning with the laser to</span></div>
<div class="line"><span class="comment">     create maps in Mapper3 (So not possible with SONARNL): */</span></div>
<div class="line"></div>
<div class="line">  ArServerHandlerMapping handlerMapping(&amp;server, &amp;robot, firstLaser, </div>
<div class="line">                    fileDir, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// make laser localization stop while mapping</span></div>
<div class="line">  handlerMapping.addMappingStartCallback(</div>
<div class="line">      <span class="keyword">new</span> ArFunctor1C&lt;ArLocalizationTask, bool&gt;</div>
<div class="line">      (&amp;locTask, &amp;<a name="a7"></a><a class="code" href="classArLocalizationTask.html#a8347691797bdba24fa53bb668be7d12e" title="Sets the idle flag.">ArLocalizationTask::setIdleFlag</a>, <span class="keyword">true</span>));</div>
<div class="line"></div>
<div class="line">  <span class="comment">// and then make it start again when we&#39;re doine</span></div>
<div class="line">  handlerMapping.addMappingEndCallback(</div>
<div class="line">      <span class="keyword">new</span> ArFunctor1C&lt;ArLocalizationTask, bool&gt;</div>
<div class="line">      (&amp;locTask, &amp;<a class="code" href="classArLocalizationTask.html#a8347691797bdba24fa53bb668be7d12e" title="Sets the idle flag.">ArLocalizationTask::setIdleFlag</a>, <span class="keyword">false</span>));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Make it so our &quot;lost&quot; actions don&#39;t stop us while mapping</span></div>
<div class="line">  handlerMapping.addMappingStartCallback(actionLostRatioDrive.getDisableCB());</div>
<div class="line">  handlerMapping.addMappingStartCallback(actionLostWander.getDisableCB());</div>
<div class="line"></div>
<div class="line">  <span class="comment">// And then let them make us stop as usual when done mapping</span></div>
<div class="line">  handlerMapping.addMappingEndCallback(actionLostRatioDrive.getEnableCB());</div>
<div class="line">  handlerMapping.addMappingEndCallback(actionLostWander.getEnableCB());</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">  // If we are on a simulator, move the robot back to its starting position,</span></div>
<div class="line"><span class="comment">  // and reset its odometry.</span></div>
<div class="line"><span class="comment">  // This will allow localizeRobotAtHomeBlocking() below will (probably) work (it</span></div>
<div class="line"><span class="comment">  // tries current odometry (which will be 0,0,0) and all the map</span></div>
<div class="line"><span class="comment">  // home points.</span></div>
<div class="line"><span class="comment">  // (Ignored by a real robot)</span></div>
<div class="line"><span class="comment">  //robot.com(ArCommands::SIM_RESET);</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// create a pose storage class, this will let the program keep track</span></div>
<div class="line">  <span class="comment">// of where the robot is between runs...  after we try and restore</span></div>
<div class="line">  <span class="comment">// from this file it will start saving the robot&#39;s pose into the</span></div>
<div class="line">  <span class="comment">// file</span></div>
<div class="line">  <a name="_a8"></a><a class="codeRef" doxygen="BaseArnl.tag:../BaseArnl-Reference//" href="../BaseArnl-Reference/classArPoseStorage.html">ArPoseStorage</a> poseStorage(&amp;robot);</div>
<div class="line">  <span class="keywordflow">if</span> (poseStorage.restorePose(<span class="stringliteral">&quot;robotPose&quot;</span>))</div>
<div class="line">    serverLocHandler.setSimPose(robot.getPose());</div>
<div class="line">  <span class="comment">//else</span></div>
<div class="line"> <span class="comment">//   robot.com(ArCommands::SIM_RESET);</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* File transfer services: */</span></div>
<div class="line">  </div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="comment">// Not implemented for Windows yet.</span></div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Note, file upload/download services are not implemented for Windows; not enabling them.&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>  <span class="comment">// This block will allow you to set up where you get and put files</span></div>
<div class="line">  <span class="comment">// to/from, just comment them out if you don&#39;t want this to happen</span></div>
<div class="line">  <span class="comment">// /*</span></div>
<div class="line">  ArServerFileLister fileLister(&amp;server, fileDir);</div>
<div class="line">  ArServerFileToClient fileToClient(&amp;server, fileDir);</div>
<div class="line">  ArServerFileFromClient fileFromClient(&amp;server, fileDir, <span class="stringliteral">&quot;/tmp&quot;</span>);</div>
<div class="line">  ArServerDeleteFileOnServer deleteFileOnServer(&amp;server, fileDir);</div>
<div class="line">  <span class="comment">// */</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Load configuration values, map, and begin! */</span></div>
<div class="line"></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// When parsing the configuration file, also look at the program&#39;s command line options </span></div>
<div class="line">  <span class="comment">// from the command-line argument parser as well as the configuration file.</span></div>
<div class="line">  <span class="comment">// (So you can use any argument on the command line, namely -map.) </span></div>
<div class="line">  Aria::getConfig()-&gt;useArgumentParser(&amp;parser);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Read in parameter files.</span></div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Loading config file %s%s into ArConfig...&quot;</span>, Aria::getDirectory(), Arnl::getTypicalParamFileName());</div>
<div class="line">  <span class="keywordflow">if</span> (!Aria::getConfig()-&gt;parseFile(Arnl::getTypicalParamFileName()))</div>
<div class="line">  {</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Could not load ARNL configuration file. Set ARNL environment variable to use non-default installation director.y&quot;</span>);</div>
<div class="line">    Aria::exit(5);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Warn about unknown params.</span></div>
<div class="line">  <span class="keywordflow">if</span> (!simpleOpener.checkAndLog() || !parser.checkHelpAndWarnUnparsed())</div>
<div class="line">  {</div>
<div class="line">    logOptions(argv[0]);</div>
<div class="line">    Aria::exit(6);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Warn if there is no map</span></div>
<div class="line">  <span class="keywordflow">if</span> (map.getFileName() == NULL || strlen(map.getFileName()) &lt;= 0)</div>
<div class="line">  {</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;### No map file is set up, you can make a map with the following procedure&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   0) You can find this information in README.txt or docs/Mapping.txt&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   1) Connect to this server with MobileEyes&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   2) Go to Tools-&gt;Map Creation-&gt;Start Scan&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   3) Give the map a name and hit okay&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   4) Drive the robot around your space (see docs/Mapping.txt&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   5) Go to Tools-&gt;Map Creation-&gt;Stop Scan&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   6) Start up Mapper3&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   7) Go to File-&gt;Open on Robot&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   8) Select the .2d you created&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;   9) Create a .map&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;  10) Go to File-&gt;Save on Robot&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;  11) In MobileEyes, go to Tools-&gt;Robot Config&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;  12) Choose the Files section&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;  13) Enter the path and name of your new .map file for the value of the Map parameter.&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;  14) Press OK and your new map should become the map used&quot;</span>);</div>
<div class="line">    ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;&quot;</span>);    </div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Print a log message notifying user of the directory for map files</span></div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">  ArLog::log(ArLog::Normal, </div>
<div class="line">         <span class="stringliteral">&quot;Directory for maps and file serving: %s&quot;</span>, fileDir);</div>
<div class="line">  </div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;See the ARNL README.txt for more information&quot;</span>);</div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Do an initial localization of the robot. ARNL and SONARNL try all the home points</span></div>
<div class="line">  <span class="comment">// in the map, as well as the robot&#39;s current odometric position, as possible</span></div>
<div class="line">  <span class="comment">// places the robot is likely to be at startup.   If successful, it will</span></div>
<div class="line">  <span class="comment">// also save the position it found to be the best localized position as the</span></div>
<div class="line">  <span class="comment">// &quot;Home&quot; position, which can be obtained from the localization task (and is</span></div>
<div class="line">  <span class="comment">// used by the &quot;Go to home&quot; network request).</span></div>
<div class="line">  <span class="comment">// MOGS instead just initializes at the current GPS position.</span></div>
<div class="line">  <span class="comment">// (You will stil have to drive the robot so it can determine the robot&#39;s</span></div>
<div class="line">  <span class="comment">// heading, however. See GPS Mapping instructions.)</span></div>
<div class="line">  locTask.localizeRobotAtHomeBlocking();</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">// Start the networking server&#39;s thread</span></div>
<div class="line">  server.runAsync();</div>
<div class="line"></div>
<div class="line">  ArLog::log(ArLog::Normal, <span class="stringliteral">&quot;Server running. To exit, press CTRL-C.&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Enable the motors and wait until the robot exits (disconnection, etc.) or this program is</span></div>
<div class="line">  <span class="comment">// canceled.</span></div>
<div class="line">  robot.enableMotors();</div>
<div class="line">  robot.waitForRunExit();</div>
<div class="line">  Aria::exit(0);</div>
<div class="line">}</div>
<div class="line"></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Nov 15 2017 13:35:45 for ARNL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1 </li>
  </ul>
</div>
</body>
</html>
